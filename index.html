<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Espresso Timer</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & Babel for browser execution -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            background: #1e293b;
            height: 6px;
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            background: #3b82f6;
            border-radius: 50%;
            margin-top: -7px;
            border: 2px solid #020617;
        }
        input {
            color: white !important;
        }
        input::placeholder {
            color: #475569 !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons({
                        attrs: {
                            class: className,
                            'stroke-width': 2,
                            width: size,
                            height: size
                        },
                        name: name
                    });
                }
            }, [name, size, className]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [view, setView] = useState('list');
            const [showImportModal, setShowImportModal] = useState(false);
            const [importCode, setImportCode] = useState('');
            const [toast, setToast] = useState(null);
            const [isMuted, setIsMuted] = useState(false);

            // --- Data State ---
            const [recipes, setRecipes] = useState([
                {
                    id: 1,
                    name: 'Classic Flair 58 Profile',
                    dose: 18,
                    yield: 36,
                    temp: 93,
                    steps: [
                        { name: 'Pre-infusion', duration: 10, pressure: 2, pressureEnd: 2 },
                        { name: 'Ramp Up', duration: 3, pressure: 2, pressureEnd: 9 },
                        { name: 'Main Extraction', duration: 20, pressure: 9, pressureEnd: 9 },
                        { name: 'Tapering', duration: 7, pressure: 9, pressureEnd: 6 }
                    ]
                }
            ]);
            const [selectedIdx, setSelectedIdx] = useState(0);
            const [editedRecipe, setEditedRecipe] = useState(null);

            // --- Timer State ---
            const [status, setStatus] = useState('idle');
            const [countdown, setCountdown] = useState(5);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [activeStepIdx, setActiveStepIdx] = useState(0);
            const timerRef = useRef(null);
            const audioCtx = useRef(null);
            const voicesRef = useRef([]);

            const currentRecipe = recipes[selectedIdx];

            const showToast = (msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 3000);
            };

            // iOS FIX: Initialize and Resume AudioContext on User Action
            const initAudio = async () => {
                try {
                    if (!audioCtx.current) {
                        audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    if (audioCtx.current.state === 'suspended') {
                        await audioCtx.current.resume();
                    }
                    // Silent sound to "wake up" audio engine on iOS
                    const buffer = audioCtx.current.createBuffer(1, 1, 22050);
                    const source = audioCtx.current.createBufferSource();
                    source.buffer = buffer;
                    source.connect(audioCtx.current.destination);
                    source.start(0);

                    // Pre-warm TTS
                    const utterance = new SpeechSynthesisUtterance("");
                    window.speechSynthesis.speak(utterance);
                } catch (e) {
                    console.error("Audio Init Error", e);
                }
            };

            const playBeep = (freq = 440, duration = 0.1, type = 'sine', volume = 0.3) => {
                if (isMuted || !audioCtx.current) return;
                try {
                    if (audioCtx.current.state === 'suspended') audioCtx.current.resume();
                    const osc = audioCtx.current.createOscillator();
                    const gain = audioCtx.current.createGain();
                    osc.type = type;
                    osc.connect(gain);
                    gain.connect(audioCtx.current.destination);
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(volume, audioCtx.current.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.current.currentTime + duration);
                    osc.start();
                    osc.stop(audioCtx.current.currentTime + duration);
                } catch (e) {}
            };

            const playStepTransition = () => {
                playBeep(880, 0.1, 'square', 0.2);
                setTimeout(() => playBeep(880, 0.1, 'square', 0.2), 150);
            };

            const playFinalBell = () => {
                let delay = 0;
                [1, 2, 3].forEach(() => {
                    setTimeout(() => playBeep(1200, 0.6, 'sawtooth', 0.2), delay);
                    delay += 700;
                });
            };

            const speak = (text) => {
                if (isMuted) return;
                
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = voicesRef.current;
                const isEnglish = /[a-zA-Z]/.test(text);
                
                if (isEnglish) {
                    // Try to find natural female English voice (iOS usually has Samantha or Karen)
                    const enVoice = voices.find(v => v.lang.startsWith('en') && (v.name.includes('Samantha') || v.name.includes('Karen') || v.name.includes('Female'))) ||
                                    voices.find(v => v.lang.startsWith('en'));
                    if (enVoice) utterance.voice = enVoice;
                    utterance.lang = 'en-US';
                } else {
                    // Try to find natural female Korean voice (iOS usually has Yuna)
                    const koVoice = voices.find(v => v.lang.startsWith('ko') && (v.name.includes('Yuna') || v.name.includes('Sora'))) ||
                                    voices.find(v => v.lang.startsWith('ko'));
                    if (koVoice) utterance.voice = koVoice;
                    utterance.lang = 'ko-KR';
                }

                utterance.pitch = 1.1;
                utterance.rate = 1.0;
                window.speechSynthesis.cancel(); // Clear queue for immediate instruction
                window.speechSynthesis.speak(utterance);
            };

            // Voice Loading for iOS
            useEffect(() => {
                const loadVoices = () => {
                    const availableVoices = window.speechSynthesis.getVoices();
                    if (availableVoices.length > 0) {
                        voicesRef.current = availableVoices;
                    }
                };
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, []);

            const totalDuration = useMemo(() => 
                currentRecipe?.steps.reduce((acc, s) => acc + s.duration, 0) || 0
            , [currentRecipe]);

            const getStepAtTime = (time) => {
                let acc = 0;
                for (let i = 0; i < currentRecipe.steps.length; i++) {
                    acc += currentRecipe.steps[i].duration;
                    if (time < acc) return i;
                }
                return currentRecipe.steps.length - 1;
            };

            useEffect(() => {
                if (status === 'countdown') {
                    const interval = setInterval(() => {
                        setCountdown(prev => {
                            if (prev <= 1) {
                                setStatus('running');
                                playStepTransition();
                                speak(currentRecipe.steps[0].name);
                                return 0;
                            }
                            playBeep(440, 0.05, 'square', 0.15);
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(interval);
                }
                if (status === 'running') {
                    const start = Date.now() - (elapsedTime * 1000);
                    timerRef.current = setInterval(() => {
                        const now = (Date.now() - start) / 1000;
                        const stepIdx = getStepAtTime(now);
                        if (stepIdx !== activeStepIdx && stepIdx < currentRecipe.steps.length) {
                            setActiveStepIdx(stepIdx);
                            playStepTransition();
                            speak(currentRecipe.steps[stepIdx].name);
                        }
                        if (now >= totalDuration) {
                            setElapsedTime(totalDuration);
                            setStatus('finished');
                            playFinalBell();
                            speak("추출 완료");
                            clearInterval(timerRef.current);
                        } else {
                            setElapsedTime(now);
                        }
                    }, 50);
                    return () => clearInterval(timerRef.current);
                }
            }, [status, activeStepIdx, currentRecipe]);

            const shareRecipe = (recipe) => {
                const data = { 
                    n: recipe.name, 
                    d: recipe.dose, 
                    y: recipe.yield, 
                    t: recipe.temp, 
                    s: recipe.steps.map(s => [s.name, s.duration, s.pressure, s.pressureEnd || s.pressure]) 
                };
                const code = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
                const tempInput = document.createElement('input');
                document.body.appendChild(tempInput);
                tempInput.value = code;
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showToast("코드가 복사되었습니다!");
            };

            const handleImport = () => {
                try {
                    const decoded = JSON.parse(decodeURIComponent(escape(atob(importCode))));
                    const newR = { 
                        id: Date.now(), 
                        name: decoded.n + " (Import)", 
                        dose: decoded.d, 
                        yield: decoded.y, 
                        temp: decoded.t, 
                        steps: decoded.s.map(s => ({ 
                            name: s[0], 
                            duration: s[1], 
                            pressure: s[2],
                            pressureEnd: s[3] || s[2]
                        })) 
                    };
                    setRecipes([...recipes, newR]);
                    setShowImportModal(false);
                    setImportCode('');
                    showToast("불러오기 성공!");
                } catch (e) { showToast("잘못된 코드입니다."); }
            };

            const ProgressGraph = ({ recipe, time, showIndicator = true }) => {
                if (!recipe) return null;
                const recipeTotal = recipe.steps.reduce((acc, s) => acc + s.duration, 0);
                let currentX = 20;
                const points = [];
                points.push(`20,${90 - (recipe.steps[0].pressure / 11) * 80}`);
                recipe.steps.forEach(s => {
                    const stepW = (s.duration / recipeTotal) * 360;
                    const endY = 90 - ((s.pressureEnd || s.pressure) / 11) * 80;
                    points.push(`${currentX + stepW},${endY}`);
                    currentX += stepW;
                });
                const progressX = 20 + (time / recipeTotal) * 360;
                return (
                    <div className="w-full bg-slate-900/50 rounded-2xl p-2 border border-white/5">
                        <svg viewBox="0 0 400 100" className="w-full h-auto">
                            {[0, 2, 4, 6, 8, 10].map(v => <line key={v} x1="20" y1={90-(v/11)*80} x2="380" y2={90-(v/11)*80} stroke="#1e293b" strokeWidth="1" />)}
                            <polyline fill="none" stroke="#3b82f6" strokeWidth="3" points={points.join(' ')} strokeLinejoin="round" />
                            {showIndicator && time > 0 && <line x1={progressX} y1="10" x2={progressX} y2="90" stroke="#f43f5e" strokeWidth="2" strokeDasharray="4" />}
                        </svg>
                    </div>
                );
            };

            if (view === 'list') {
                return (
                    <div className="min-h-screen safe-top safe-bottom px-6 py-8 flex flex-col items-center">
                        <div className="w-full max-w-md">
                            <div className="flex justify-between items-center mb-10">
                                <h1 className="text-3xl font-black bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent italic">FLAIR 58</h1>
                                <div className="flex gap-2">
                                    <button onClick={() => setShowImportModal(true)} className="p-3 bg-slate-900 rounded-2xl border border-slate-800"><Icon name="download" className="text-blue-400" /></button>
                                    <button onClick={() => {
                                        const r = { id: Date.now(), name: 'New Recipe', dose: 18, yield: 36, temp: 93, steps: [{ name: 'Extraction', duration: 30, pressure: 9, pressureEnd: 9 }] };
                                        setRecipes([...recipes, r]);
                                        setSelectedIdx(recipes.length);
                                        setEditedRecipe(r);
                                        setView('detail');
                                    }} className="p-3 bg-blue-600 rounded-2xl shadow-lg shadow-blue-900/20 text-white"><Icon name="plus" /></button>
                                </div>
                            </div>
                            <div className="space-y-4">
                                {recipes.map((r, i) => (
                                    <div key={r.id} onClick={() => { setSelectedIdx(i); setEditedRecipe({...r}); setView('detail'); }} className="bg-slate-900 border border-slate-800 rounded-[2.5rem] p-6 active:scale-95 transition-transform">
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <h2 className="text-xl font-bold mb-2 text-white">{r.name}</h2>
                                                <div className="flex gap-4 text-xs font-bold text-slate-400 uppercase tracking-widest">
                                                    <span className="bg-slate-800 px-2 py-0.5 rounded text-white">{r.dose}g</span>
                                                    <span className="bg-blue-900/30 px-2 py-0.5 rounded text-blue-400">{r.yield}g</span>
                                                    <span className="bg-rose-900/30 px-2 py-0.5 rounded text-rose-400">{r.temp}°C</span>
                                                </div>
                                            </div>
                                            <Icon name="chevron-right" size={20} className="text-slate-600" />
                                        </div>
                                        <ProgressGraph recipe={r} time={0} showIndicator={false} />
                                    </div>
                                ))}
                            </div>
                        </div>
                        {showImportModal && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-6 text-white">
                                <div className="bg-slate-900 w-full max-w-sm rounded-3xl p-6 border border-slate-800">
                                    <h3 className="text-xl font-bold mb-4">레시피 불러오기</h3>
                                    <textarea className="w-full h-32 bg-slate-800 border-none rounded-2xl p-4 text-xs font-mono mb-4 text-slate-100" value={importCode} onChange={e => setImportCode(e.target.value)} placeholder="코드를 붙여넣으세요" />
                                    <div className="flex gap-2">
                                        <button onClick={() => setShowImportModal(false)} className="flex-1 py-3 bg-slate-800 rounded-xl font-bold">취소</button>
                                        <button onClick={handleImport} className="flex-1 py-3 bg-blue-600 rounded-xl font-bold">가져오기</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {toast && <div className="fixed bottom-10 bg-blue-600 text-white px-6 py-3 rounded-full font-bold shadow-2xl transition-opacity z-50">{toast}</div>}
                    </div>
                );
            }

            if (view === 'detail') {
                const ratio = (editedRecipe.yield / editedRecipe.dose).toFixed(1);
                return (
                    <div className="min-h-screen safe-top safe-bottom px-6 py-8 flex flex-col items-center text-white">
                        <div className="w-full max-w-md pb-40">
                            <div className="flex justify-between items-center mb-6">
                                <button onClick={() => setView('list')} className="p-2 text-slate-400"><Icon name="chevron-left" size={32}/></button>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsMuted(!isMuted)} className="p-3 bg-slate-900 rounded-xl border border-slate-800"><Icon name={isMuted ? "volume-x" : "volume-2"} size={20}/></button>
                                    <button onClick={() => shareRecipe(editedRecipe)} className="p-3 bg-slate-900 rounded-xl border border-slate-800 text-blue-400"><Icon name="share-2" size={20}/></button>
                                    <button onClick={() => { if(recipes.length > 1) { setRecipes(recipes.filter((_, i) => i !== selectedIdx)); setView('list'); } }} className="p-3 bg-rose-500/10 text-rose-500 rounded-xl"><Icon name="trash-2" size={20}/></button>
                                </div>
                            </div>
                            <input className="w-full bg-transparent text-3xl font-black mb-8 focus:outline-none text-white" value={editedRecipe.name} onChange={e => setEditedRecipe({...editedRecipe, name: e.target.value})} />
                            
                            <div className="grid grid-cols-3 gap-3 mb-8">
                                <div className="bg-slate-900 p-4 pt-5 rounded-3xl border border-slate-800 relative">
                                    <label className="text-[10px] text-slate-500 font-black absolute top-3 left-4 uppercase tracking-tighter">Dose (g)</label>
                                    <input type="number" className="w-full bg-transparent font-mono text-2xl font-black focus:outline-none text-white mt-1" value={editedRecipe.dose} onChange={e => setEditedRecipe({...editedRecipe, dose: Number(e.target.value)})} />
                                </div>
                                <div className="bg-slate-900 p-4 pt-5 rounded-3xl border border-slate-800 relative">
                                    <label className="text-[10px] text-slate-500 font-black absolute top-3 left-4 uppercase tracking-tighter">Yield ({ratio})</label>
                                    <input type="number" className="w-full bg-transparent font-mono text-2xl font-black focus:outline-none text-blue-400 mt-1" value={editedRecipe.yield} onChange={e => setEditedRecipe({...editedRecipe, yield: Number(e.target.value)})} />
                                </div>
                                <div className="bg-slate-900 p-4 pt-5 rounded-3xl border border-slate-800 relative">
                                    <label className="text-[10px] text-slate-500 font-black absolute top-3 left-4 uppercase tracking-tighter">Temp (°C)</label>
                                    <input type="number" className="w-full bg-transparent font-mono text-2xl font-black focus:outline-none text-rose-400 mt-1" value={editedRecipe.temp} onChange={e => setEditedRecipe({...editedRecipe, temp: Number(e.target.value)})} />
                                </div>
                            </div>

                            <div className="mb-8 px-1">
                                <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 px-1 flex justify-between">
                                    <span>Pressure Profile</span>
                                    <span>Ratio 1:{ratio}</span>
                                </div>
                                <ProgressGraph recipe={editedRecipe} time={0} showIndicator={false} />
                            </div>

                            <div className="space-y-4">
                                {editedRecipe.steps.map((s, idx) => (
                                    <div key={idx} className="bg-slate-900 p-5 rounded-3xl border border-slate-800">
                                        <div className="flex gap-2 mb-6">
                                            <input className="flex-1 bg-slate-800 rounded-xl px-4 py-3 text-sm font-bold text-white focus:ring-1 ring-blue-500" value={s.name} onChange={e => {
                                                const ns = [...editedRecipe.steps]; ns[idx].name = e.target.value; setEditedRecipe({...editedRecipe, steps: ns});
                                            }} />
                                            <div className="flex items-center gap-2 bg-slate-800 px-3 rounded-xl">
                                                <input type="number" className="w-8 bg-transparent text-center font-mono text-blue-400 font-bold" value={s.duration} onChange={e => {
                                                    const ns = [...editedRecipe.steps]; ns[idx].duration = Number(e.target.value); setEditedRecipe({...editedRecipe, steps: ns});
                                                }} />
                                                <span className="text-[10px] text-slate-500 font-bold">S</span>
                                            </div>
                                        </div>
                                        <div className="space-y-5">
                                            <div className="flex flex-col gap-2">
                                                <div className="flex justify-between text-[10px] font-bold text-slate-500 px-1">
                                                    <span>PRESSURE (START)</span>
                                                    <span className="text-cyan-400">{s.pressure} bar</span>
                                                </div>
                                                <input type="range" min="0" max="11" step="0.5" className="w-full" value={s.pressure} onChange={e => {
                                                    const ns = [...editedRecipe.steps]; ns[idx].pressure = Number(e.target.value); 
                                                    if (ns[idx].pressureEnd === undefined) ns[idx].pressureEnd = ns[idx].pressure;
                                                    setEditedRecipe({...editedRecipe, steps: ns});
                                                }} />
                                            </div>
                                            <div className="flex flex-col gap-2">
                                                <div className="flex justify-between text-[10px] font-bold text-slate-500 px-1">
                                                    <span>PRESSURE (END)</span>
                                                    <span className="text-blue-400">{(s.pressureEnd !== undefined ? s.pressureEnd : s.pressure)} bar</span>
                                                </div>
                                                <input type="range" min="0" max="11" step="0.5" className="w-full" value={s.pressureEnd !== undefined ? s.pressureEnd : s.pressure} onChange={e => {
                                                    const ns = [...editedRecipe.steps]; ns[idx].pressureEnd = Number(e.target.value); setEditedRecipe({...editedRecipe, steps: ns});
                                                }} />
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={() => setEditedRecipe({...editedRecipe, steps: [...editedRecipe.steps, { name: 'Step', duration: 10, pressure: 6, pressureEnd: 6 }]})} className="w-full py-5 border-2 border-dashed border-slate-800 rounded-3xl text-slate-500 font-bold hover:border-slate-600 hover:text-slate-400 transition-all">+ 단계 추가</button>
                            </div>

                            <div className="fixed bottom-0 left-0 w-full p-6 safe-bottom bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent z-40">
                                <div className="max-w-md mx-auto flex gap-3">
                                    <button onClick={() => { setRecipes(prev => { const n = [...prev]; n[selectedIdx] = editedRecipe; return n; }); setView('list'); showToast("저장되었습니다."); }} className="flex-1 py-5 bg-slate-800 rounded-[2rem] font-bold text-lg text-white">저장</button>
                                    <button onClick={async () => { await initAudio(); setElapsedTime(0); setActiveStepIdx(0); setCountdown(5); setStatus('countdown'); setView('active'); }} className="flex-[2] py-5 bg-blue-600 rounded-[2rem] font-black text-xl shadow-2xl shadow-blue-900/40 text-white">추출 시작</button>
                                </div>
                            </div>
                        </div>
                        {toast && <div className="fixed bottom-32 bg-blue-600 text-white px-6 py-3 rounded-full font-bold shadow-2xl z-[60]">{toast}</div>}
                    </div>
                );
            }

            // 3. Active Timer View
            const activeStep = currentRecipe.steps[activeStepIdx];
            const isPressureRange = activeStep && activeStep.pressureEnd !== undefined && activeStep.pressure !== activeStep.pressureEnd;

            return (
                <div className="min-h-screen safe-top safe-bottom p-8 flex flex-col items-center overflow-hidden text-white">
                    <div className="w-full max-w-md h-full flex flex-col">
                        <header className="flex justify-between items-start mb-8">
                            <div className="space-y-2">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                                    <h2 className="text-sm font-bold tracking-widest uppercase text-slate-300">{currentRecipe.name}</h2>
                                </div>
                                <div className="flex gap-4 text-xs font-mono text-slate-400 font-black">
                                    <span className="bg-slate-900 px-2 py-1 rounded text-white">{currentRecipe.dose}g</span>
                                    <span className="bg-blue-900/40 px-2 py-1 rounded text-blue-400">{currentRecipe.yield}g</span>
                                    <span className="bg-rose-900/40 px-2 py-1 rounded text-rose-400">{currentRecipe.temp}°C</span>
                                </div>
                            </div>
                            <button onClick={() => { setStatus('idle'); setElapsedTime(0); setView('list'); }} className="p-2 text-slate-600"><Icon name="rotate-ccw" /></button>
                        </header>

                        <main className="flex-1 flex flex-col justify-center">
                            {status === 'countdown' ? (
                                <div className="text-center">
                                    <div className="text-[12rem] font-black text-blue-500 leading-none tracking-tighter">{countdown}</div>
                                    <div className="text-xl font-bold tracking-[0.5em] text-slate-600">READY</div>
                                </div>
                            ) : (
                                <div className="space-y-12">
                                    <div className="text-center">
                                        <div className="text-xl font-bold text-slate-400 uppercase tracking-[0.3em] mb-2">{activeStep?.name}</div>
                                        <div className="flex items-center justify-center gap-3">
                                            {isPressureRange ? (
                                                <div className="flex flex-col items-center">
                                                    <div className="text-[6rem] font-black leading-none text-white tracking-tighter flex items-center gap-4">
                                                        {activeStep.pressure} <span className="text-4xl text-slate-600">~</span> {activeStep.pressureEnd}
                                                    </div>
                                                    <div className="text-2xl font-black text-cyan-500 mt-4 uppercase tracking-widest italic">BAR RANGE</div>
                                                </div>
                                            ) : (
                                                <div className="flex items-center justify-center gap-3">
                                                    <div className="text-[10rem] font-black leading-none text-white tracking-tighter">{activeStep?.pressure}</div>
                                                    <div className="text-2xl font-black text-cyan-500 mt-12">BAR</div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="space-y-8">
                                        <ProgressGraph recipe={currentRecipe} time={elapsedTime} />
                                        <div className="flex justify-between items-end px-2">
                                            <div className="text-7xl font-mono font-bold tabular-nums text-white">
                                                {elapsedTime.toFixed(1)}<span className="text-2xl text-slate-600 ml-1 italic">s</span>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-[10px] font-black text-slate-500 uppercase mb-1">Remaining</div>
                                                <div className="text-3xl font-mono text-slate-300">{(totalDuration - elapsedTime).toFixed(1)}s</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </main>

                        <footer className="mt-12 py-8">
                            {status === 'finished' ? (
                                <button onClick={() => { setStatus('idle'); setElapsedTime(0); setView('list'); }} className="w-full py-6 bg-slate-900 border border-blue-900/30 rounded-[2.5rem] text-2xl font-black text-blue-400 shadow-2xl active:scale-95 transition-transform">DONE</button>
                            ) : (
                                <div className="grid grid-cols-4 gap-2">
                                    {currentRecipe.steps.map((_, i) => (
                                        <div key={i} className={`h-1.5 rounded-full ${i === activeStepIdx ? 'bg-blue-500 shadow-lg shadow-blue-500/50' : i < activeStepIdx ? 'bg-slate-700' : 'bg-slate-900'}`} />
                                    ))}
                                </div>
                            )}
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>